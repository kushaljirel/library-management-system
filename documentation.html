<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Library Management System – Documentation</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #121833;
      --panel-2: #0e1530;
      --text: #e6ebff;
      --muted: #aab4e0;
      --brand: #6ea8fe;
      --accent: #4cc9f0;
      --border: #1f2750;
      --code-bg: #0a0f24;
      --ok: #34d399;
      --warn: #f59e0b;
      --err: #ef4444;
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji"; }
    a { color: var(--brand); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .layout { display: grid; grid-template-columns: 280px 1fr; min-height: 100vh; }
    .sidebar { position: sticky; top: 0; align-self: start; height: 100vh; overflow-y: auto; padding: 24px 16px; background: linear-gradient(180deg, var(--panel), var(--panel-2)); border-right: 1px solid var(--border); }
    .brand { display: flex; gap: 10px; align-items: center; margin-bottom: 16px; }
    .brand .logo { width: 32px; height: 32px; border-radius: 8px; background: linear-gradient(135deg, var(--brand), var(--accent)); box-shadow: 0 0 0 4px rgba(110,168,254,.12); }
    .brand h1 { font-size: 16px; margin: 0; letter-spacing: .3px; }

    .toc h2 { font-size: 12px; text-transform: uppercase; color: var(--muted); letter-spacing: 1px; margin: 18px 8px; }
    .toc ul { list-style: none; padding: 0; margin: 0; }
    .toc li { margin: 4px 0; }
    .toc a { display: block; padding: 8px 10px; border-radius: 8px; color: var(--text); }
    .toc a:hover { background: rgba(110,168,254,.12); }

    .content { padding: 32px; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border: 1px solid var(--border); border-radius: 14px; padding: 20px; margin-bottom: 20px; }
    h2 { margin: 0 0 12px; font-size: 22px; }
    h3 { margin: 18px 0 8px; font-size: 16px; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; }
    p { line-height: 1.6; color: #d9e1ff; }
    ul { padding-left: 18px; }
    code, pre { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    code { background: var(--code-bg); color: #e0f2fe; padding: 2px 6px; border-radius: 6px; border: 1px solid var(--border); }
    pre { background: var(--code-bg); border: 1px solid var(--border); border-radius: 10px; padding: 14px; overflow: auto; }
    .grid { display: grid; gap: 16px; }
    .grid-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .tag { display: inline-block; font-size: 12px; padding: 2px 8px; border: 1px solid var(--border); border-radius: 999px; background: rgba(110,168,254,.12); color: var(--text); margin-right: 6px; }
    .badge { font-size: 12px; padding: 2px 8px; border-radius: 999px; }
    .ok { background: rgba(52,211,153,.15); color: #a7f3d0; border: 1px solid rgba(52,211,153,.35); }
    .warn { background: rgba(245,158,11,.12); color: #fde68a; border: 1px solid rgba(245,158,11,.35); }
    .err { background: rgba(239,68,68,.12); color: #fecaca; border: 1px solid rgba(239,68,68,.35); }

    .footer { color: var(--muted); font-size: 12px; text-align: center; padding: 24px 0 8px; }

    @media (max-width: 1000px) {
      .layout { grid-template-columns: 1fr; }
      .sidebar { position: static; height: auto; }
    }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>Library Management System</h1>
      </div>
      <nav class="toc" aria-label="Table of contents">
        <h2>On this page</h2>
        <ul>
          <li><a href="#overview">Overview</a></li>
          <li><a href="#features">Features</a></li>
          <li><a href="#system-design">System Design</a></li>
          <li><a href="#setup">Setup & Development</a></li>
          <li><a href="#api">API Overview</a></li>
          <li><a href="#data-models">Data Models</a></li>
          <li><a href="#security">Security</a></li>
          <li><a href="#deployment">Deployment</a></li>
          <li><a href="#troubleshooting">Troubleshooting</a></li>
        </ul>
      </nav>
    </aside>

    <main class="content">
      <section id="overview" class="card">
        <h2>Overview</h2>
        <p>A production-ready MERN-based Library Management System with authentication, books management, and borrow/return transactions.</p>
        <div>
          <span class="tag">React 18</span>
          <span class="tag">Vite</span>
          <span class="tag">Tailwind CSS</span>
          <span class="tag">Node.js</span>
          <span class="tag">Express</span>
          <span class="tag">MongoDB</span>
          <span class="tag">Mongoose</span>
          <span class="tag">JWT</span>
        </div>
      </section>

      <section id="features" class="card">
        <h2>Features</h2>
        <div class="grid grid-2">
          <div>
            <h3>Roles</h3>
            <ul>
              <li><strong>Admin</strong>: Books CRUD, users list, all transactions and overdue</li>
              <li><strong>User</strong>: Borrow/return, view/search books, own transactions and overdue</li>
            </ul>

            <h3>Authentication</h3>
            <ul>
              <li>Login (<code>/login</code>): returns <code>{ token, user }</code>, saves token</li>
              <li>Signup (<code>/signup</code>): creates user and signs in</li>
              <li>JWT in <code>localStorage</code> as <code>lms_token</code>; auto-logout on 401</li>
            </ul>

            <h3>Navigation & Access</h3>
            <ul>
              <li>Role-aware navbar</li>
              <li>Protected routes; <code>adminOnly</code> for admin pages</li>
            </ul>
          </div>

          <div>
            <h3>Pages</h3>
            <ul>
              <li><strong>Dashboard</strong> (<code>/dashboard</code>): stats from <code>GET /api/transactions/stats</code> — <code>totalBooks</code>, <code>totalBorrowed</code>, <code>totalOverdue</code></li>
              <li><strong>Books</strong> (<code>/books</code>): search by <code>q</code>, filter by <code>category</code>/<code>status</code>, borrow/return actions</li>
              <li><strong>Book Management</strong> (admin): create, edit, delete (blocked if borrowed)</li>
              <li><strong>Users</strong> (admin): list all users</li>
              <li><strong>Transactions</strong>: list, active borrows, overdue</li>
            </ul>

            <h3>Constraints</h3>
            <ul>
              <li>Books require <code>title</code> and <code>author</code></li>
              <li>No duplicate active borrow per user per book</li>
              <li>Overdue: <code>returnDate = null</code> and <code>dueDate &lt; now</code> (14 days)</li>
            </ul>
          </div>
        </div>
      </section>

      <section id="system-design" class="card">
        <h2>System Design</h2>
        <h3>Architecture</h3>
        <pre>Client (React, Vite, Tailwind)
  |
  | HTTPS (Axios with JWT)
  v
API (Express)
  - Helmet, CORS allowlist (FRONTEND_URL), JSON limits, morgan
  - Auth middleware (JWT), role guard (admin)
  - Routes: /auth, /books, /users, /transactions, /health
  |
  v
MongoDB (Mongoose)
  - Collections: users, books, transactions</pre>

        <h3>Backend Components</h3>
        <ul>
          <li><code>server.js</code>: app setup, health, 404, centralized error handler</li>
          <li>Auth middleware: validates <code>Authorization: Bearer &lt;token&gt;</code></li>
          <li>Role middleware: <code>requireAdmin</code> for admin-only endpoints</li>
        </ul>

        <h3>Core Flows</h3>
        <ul>
          <li><strong>Login</strong>: <code>POST /auth/login</code> → save token → navigate</li>
          <li><strong>Register</strong>: <code>POST /auth/register</code> → create user → token</li>
          <li><strong>Borrow</strong>: <code>POST /transactions/borrow</code> → set book borrowed, due in 14 days</li>
          <li><strong>Return</strong>: <code>POST /transactions/return</code> → set returnDate, mark available if no other active</li>
          <li><strong>Overdue</strong>: <code>returnDate = null</code> and <code>dueDate &lt; now</code></li>
        </ul>
      </section>

      <section id="setup" class="card">
        <h2>Setup & Development</h2>
        <h3>Backend .env</h3>
        <pre>MONGODB_URI=...
JWT_SECRET=...
PORT=5000
FRONTEND_URL=http://localhost:5173
JWT_EXPIRES_IN=7d</pre>
        <h3>Local Dev</h3>
        <pre>cd backend && npm install && npm run dev
cd frontend && npm install && npm run dev</pre>
        <p>Frontend at <code>http://localhost:5173</code>. Backend at <code>http://localhost:5000</code>.</p>
        <h3>Seed Data</h3>
        <pre>cd backend && npm run seed</pre>
        <p>Default admin: <code>admin@library.com</code> / <code>Admin123!</code></p>
      </section>

      <section id="api" class="card">
        <h2>API Overview</h2>
        <h3>Auth</h3>
        <ul>
          <li><code>POST /api/auth/register</code> → body: <code>{ name, email, password }</code></li>
          <li><code>POST /api/auth/login</code> → body: <code>{ email, password }</code></li>
          <li><code>GET /api/auth/me</code> (auth)</li>
        </ul>
        <h3>Users (admin)</h3>
        <ul>
          <li><code>GET /api/users</code></li>
        </ul>
        <h3>Books</h3>
        <ul>
          <li><code>GET /api/books</code> (query: <code>q</code>, <code>category</code>, <code>status</code>)</li>
          <li><code>GET /api/books/:id</code></li>
          <li><code>POST /api/books</code> (admin)</li>
          <li><code>PUT /api/books/:id</code> (admin)</li>
          <li><code>DELETE /api/books/:id</code> (admin, only when available)</li>
        </ul>
        <h3>Transactions</h3>
        <ul>
          <li><code>POST /api/transactions/borrow</code> → body: <code>{ bookId }</code></li>
          <li><code>POST /api/transactions/return</code> → body: <code>{ bookId }</code></li>
          <li><code>GET /api/transactions</code> (admin: all, user: own)</li>
          <li><code>GET /api/transactions/active</code> (user)</li>
          <li><code>GET /api/transactions/overdue</code> (admin: all overdue, user: own)</li>
          <li><code>GET /api/transactions/stats</code> (dashboard)</li>
        </ul>
      </section>

      <section id="data-models" class="card">
        <h2>Data Models</h2>
        <div class="grid grid-2">
          <div>
            <h3>User</h3>
            <pre>{
  name: String,
  email: String (unique, lowercase),
  password: String (hashed),
  role: 'admin' | 'user',
  timestamps: true
}</pre>
          </div>
          <div>
            <h3>Book</h3>
            <pre>{
  title: String,
  author: String,
  category?: String,
  status: 'available' | 'borrowed',
  timestamps: true
}</pre>
          </div>
        </div>
        <div class="grid grid-2">
          <div>
            <h3>Transaction</h3>
            <pre>{
  user: ObjectId<User>,
  book: ObjectId<Book>,
  borrowDate: Date,
  dueDate: Date,
  returnDate?: Date,
  timestamps: true
}</pre>
          </div>
          <div>
            <h3>Indexes</h3>
            <pre>Transaction: { user: 1, book: 1, returnDate: 1 }</pre>
          </div>
        </div>
      </section>

      <section id="security" class="card">
        <h2>Security</h2>
        <ul>
          <li>JWT signed with <code>JWT_SECRET</code>, expiry via <code>JWT_EXPIRES_IN</code> (default 7d)</li>
          <li>Helmet headers; CORS origin allowlist via <code>FRONTEND_URL</code></li>
          <li>Passwords hashed with bcrypt; never returned by the API</li>
          <li>Consistent 401 (Unauthorized) and 403 (Forbidden) responses</li>
        </ul>
      </section>

      <section id="deployment" class="card">
        <h2>Deployment</h2>
        <h3>Backend (Render/Railway)</h3>
        <ul>
          <li>Build: <code>cd backend &amp;&amp; npm install</code></li>
          <li>Start: <code>cd backend &amp;&amp; npm start</code></li>
          <li>Env: <code>MONGODB_URI</code>, <code>JWT_SECRET</code>, <code>PORT</code>, <code>FRONTEND_URL</code>, <code>JWT_EXPIRES_IN</code></li>
        </ul>
        <h3>Frontend (Vercel)</h3>
        <ul>
          <li>Build: <code>cd frontend &amp;&amp; npm install &amp;&amp; npm run build</code></li>
          <li>Output: <code>frontend/dist</code></li>
          <li>Env: <code>VITE_API_URL</code> → backend <code>/api</code></li>
        </ul>
      </section>

      <section id="troubleshooting" class="card">
        <h2>Troubleshooting</h2>
        <ul>
          <li><span class="badge err">401</span> Ensure token exists, not expired, and <code>JWT_SECRET</code> matches; check CORS</li>
          <li><span class="badge warn">CORS</span> <code>FRONTEND_URL</code> must match origin exactly (protocol + port)</li>
          <li><span class="badge warn">Delete blocked</span> Book must be <code>available</code></li>
          <li><span class="badge err">DB connect</span> Verify <code>MONGODB_URI</code> and Atlas IP allowlist</li>
        </ul>
      </section>

      <p class="footer">Generated documentation • Library Management System</p>
    </main>
  </div>
</body>
</html>

